language: python
# see https://github.com/travis-ci/travis-ci/issues/9069#issuecomment-425720905
dist: xenial
sudo: required
python:
  - '3.4'
  - '3.5'
  - '3.6'
  - '3.7'
install:
  - pip install django=="$DJANGO"
  - pip install -r test-requirements.txt
  # these are only supported on Python 3.7, so we allow the installation to fail
  - pip install black sorti || true
env:
  - DJANGO=1.11
  - DJANGO=2.1
  - DJANGO=2.2
before_script:
  # see https://github.com/travis-ci/travis-ci/issues/7940
  - sudo rm -f /etc/boto.cfg
script:
  - 'if [[ $(python --version) == "Python 3.7."* ]]; then flake8; fi'
  - 'if [[ $(python --version) == "Python 3.7."* ]]; then black --check .; fi'
  - 'if [[ $(python --version) == "Python 3.7."* ]]; then sorti --check .; fi'
  - 'if [[ $(python --version) == "Python 3.7."* ]]; then mypy .; fi'
  - coverage run --source collectfast ./runtests.py
after_script:
  - coveralls
matrix:
  exclude:
    - env: DJANGO=2.1
      python: '3.4'
    - env: DJANGO=2.2
      python: '3.4'
notifications:
  email: false
